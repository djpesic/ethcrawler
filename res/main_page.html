<!DOCTYPE html>
<html>
<head>
<script>
function getTransactions() {
    let address = document.getElementById("address").value;
    let block_number = document.getElementById("block_number").value;
    if (!(address.match("^0x[a-fA-F0-9]{40}$"))){
        alert("Wrong ethereum address format");
        return false;
    }
    if (!(block_number.match("^[0-9]+$"))){
        alert("Wrong ethereum block number format");
        return false;
    }
    document.getElementById("status").textContent='Loading...';
    fetch('crawler/get_transactions', {
            method: 'POST',
            body: 'address='+address+'&block_number='+block_number,
            headers: {
                'Content-type': 'application/x-www-form-urlencoded; charset=UTF-8'
            }
        })
        .then(response => response.json())
        .then(json => display_response(json));
        // .catch(err => {
        //     document.getElementById("status").textContent=err;
        // });
    
    return true;
}
function display_response(transactions){
    document.getElementById("status").textContent='';
    let table_body=document.getElementById("body");
    table_body.innerHTML='';
    transactions.forEach(transaction => {
        let tr = document.createElement('tr');
        let td_address = document.createElement('td');
        td_address.innerHTML = transaction.address;
        let td_direction = document.createElement('td');
        td_direction.innerHTML = transaction.direction;
        let td_fee = document.createElement('td');
        td_fee.innerHTML = transaction.transaction_fee;
        let td_transferred = document.createElement('td');
        td_transferred.innerHTML = transaction.transfered;
        tr.appendChild(td_address);
        tr.appendChild(td_direction);
        tr.appendChild(td_transferred);
        tr.appendChild(td_fee);
        table_body.appendChild(tr);
    });
    fetch('crawler/number_of_batches')
    .then(response => response.json())
    .then(json => {
        document.getElementById("total-batch-number").innerHTML = json;
        document.getElementById("batch-number").value = 1;
    });
}
</script>
</head>
    <fieldset>
      <legend>Input data</legend>
      <div>
        <label for="address">Address</label><br/>
        <input type="text" id="address" placeholder="Enter wallet address" size="50" required /><br/>
      </div>

      <div>
        <label for="blok_number">Block number</label><br/>
        <input
          type="text"
          name="block_number"
          id="block_number"
          placeholder="Enter start block number"
          size="50"
          required
        /><br/>
      </div>
      <div>
        <button type="button" id="get_transactions" onclick="getTransactions()">Get transactions</button>
      </div>
    </fieldset>
<fieldset>
    <legend>Results </legend><br>
    <label id="status"></label>
    <div style="align-items: center;">
        <button id="prev-button" onclick="prev_batch()">Previous</button>   
        <button id="next-button" onclick="next_batch()">Next</button>
        <input id="batch-number"></input>
        <label >/</label>      
        <label id="total-batch-number"></label>
        <table>
            <thead>
                <tr>
                  <th>Address</th>
                  <th>Direction</th>
                  <th>Transferred</th>
                  <th>Fee</th>
                </tr>
            </thead>
            <tbody id="body">
            </tbody>
        </table>
    </div>
</fieldset>

</html>